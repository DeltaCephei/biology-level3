---
/* ==========================================================================
   [week].astro — Dynamic Week Page
   Level 3 NCEA Biology Course Platform

   Generates static pages for weeks 1–40 via getStaticPaths().
   Week 1 has full placeholder data; all other weeks show a "coming soon" state.
   ========================================================================== */

import BaseLayout from '../../layouts/BaseLayout.astro';

const base = import.meta.env.BASE_URL;

/* --------------------------------------------------------------------------
   Static Path Generation
   Astro builds one HTML page per week at /week/1, /week/2, ..., /week/40.
   -------------------------------------------------------------------------- */
/* Week 3 has a dedicated page (3.astro), so exclude it from dynamic generation */
export function getStaticPaths() {
  return Array.from({ length: 40 }, (_, i) => ({
    params: { week: String(i + 1) },
  })).filter(p => p.params.week !== '3');
}

/* --------------------------------------------------------------------------
   Week Data
   Week 1 has full placeholder content. All others return a minimal stub.
   In future, this will be replaced by content collection queries.
   -------------------------------------------------------------------------- */
interface WeekData {
  title: string;
  standard: string;
  standardCode: string;
  standardColour: string;
  term: number;
  topics: string[];
  learningObjectives: string[];
  keyVocabulary: string[];
  teamsReference: string;
  hasContent: boolean;
}

const weekData: Record<string, WeekData> = {
  '1': {
    title: 'Introduction to Animal Responses',
    standard: 'Responses of plants and animals to their external environment',
    standardCode: 'AS 91603',
    standardColour: 'var(--standard-3-colour)',
    term: 1,
    topics: [
      'Overview of homeostasis',
      'The stimulus-response pathway',
      'Receptors and effectors',
      'Nervous vs hormonal responses',
    ],
    learningObjectives: [
      'Define homeostasis and explain why it matters for organisms',
      'Describe the stimulus-response pathway from receptor to effector',
      'Distinguish between nervous and hormonal communication',
      'Identify examples of stimuli and responses in New Zealand animals',
    ],
    keyVocabulary: [
      'homeostasis',
      'stimulus',
      'response',
      'receptor',
      'effector',
      'nerve impulse',
      'hormone',
      'negative feedback',
    ],
    teamsReference: 'Week 1: Stimulus-response diagram — due Friday',
    hasContent: true,
  },
};

/* --------------------------------------------------------------------------
   Page Setup
   -------------------------------------------------------------------------- */
const { week } = Astro.params;
const weekNum = parseInt(week!, 10);

/* Look up this week's data, or fall back to a "coming soon" stub */
const data: WeekData = weekData[week!] ?? {
  title: `Week ${weekNum}`,
  standard: '',
  standardCode: '',
  standardColour: 'var(--text-muted)',
  term: Math.ceil(weekNum / 10),
  topics: [],
  learningObjectives: [],
  keyVocabulary: [],
  teamsReference: '',
  hasContent: false,
};

/* Calculate the term from the week number (roughly 10 weeks per term) */
const term = data.term;
---

<BaseLayout title={`Week ${weekNum} — Level 3 Biology`}>

  <div class="week-page">

    <!-- ====================================================================
         Week Header
         ==================================================================== -->
    <header class="week-header fade-in-up">
      <div class="week-header__meta">
        <a href={base} class="back-link">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
            <path d="M13 8H3M7 4L3 8l4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Back to Dashboard
        </a>
        <span class="term-badge">Term {term}</span>
      </div>

      <div class="week-header__title-row">
        <span class="week-number">Week {weekNum}</span>
        <h1 class="week-title">{data.title}</h1>
      </div>

      {data.standardCode && (
        <div class="week-header__badges">
          <span class="badge badge--standard" style={`--badge-colour: ${data.standardColour};`}>
            {data.standardCode}
          </span>
          <span class="badge badge--desc">{data.standard}</span>
        </div>
      )}
    </header>


    {data.hasContent ? (
      <!-- ================================================================
           Full content layout for weeks with data
           ================================================================ -->
      <div class="week-layout">

        <!-- Main content column -->
        <main class="week-main">

          <!-- Content area placeholder -->
          <section class="content-card fade-in-up" aria-label="Support notes">
            <h2>Support Notes</h2>
            <div class="placeholder-content">
              <p>Support notes for this week coming soon...</p>
              <p class="placeholder-hint">
                This section will contain detailed topic explanations, diagrams,
                and key concepts for the week's learning.
              </p>
            </div>
          </section>

          <!-- Topics covered -->
          <section class="content-card fade-in-up" aria-label="Topics">
            <h2>Topics This Week</h2>
            <ul class="topic-list">
              {data.topics.map((topic) => (
                <li class="topic-item">
                  <span class="topic-bullet" aria-hidden="true"></span>
                  {topic}
                </li>
              ))}
            </ul>
          </section>

          <!-- Key Vocabulary -->
          <section class="content-card fade-in-up" aria-label="Key vocabulary">
            <h2>Key Vocabulary</h2>
            <div class="vocab-grid">
              {data.keyVocabulary.map((term) => (
                <div class="vocab-chip">
                  {term}
                </div>
              ))}
            </div>
            <p class="placeholder-hint">
              Definitions and usage examples will be added here.
            </p>
          </section>

        </main>

        <!-- Sidebar -->
        <aside class="week-sidebar">

          <!-- Practice card -->
          <div class="sidebar-card fade-in-up">
            <h3>This Week's Practice</h3>
            <div class="sidebar-links">
              <a href={`${base}/flashcards?week=${weekNum}`} class="sidebar-link">
                <span class="sidebar-link__icon" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 32 32" fill="none">
                    <rect x="4" y="8" width="20" height="16" rx="3" stroke="var(--green-vivid)" stroke-width="1.5" fill="none"/>
                    <rect x="8" y="4" width="20" height="16" rx="3" stroke="var(--green-muted)" stroke-width="1.5" fill="none" opacity="0.5"/>
                  </svg>
                </span>
                <span>Flashcards</span>
                <span class="sidebar-link__count">12 cards</span>
              </a>
              <a href={`${base}/quiz?week=${weekNum}`} class="sidebar-link">
                <span class="sidebar-link__icon" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 32 32" fill="none">
                    <circle cx="16" cy="16" r="11" stroke="var(--fluoro-cyan)" stroke-width="1.5" fill="none"/>
                    <path d="M13 16.5l2.5 2.5L20 13" stroke="var(--fluoro-cyan)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </span>
                <span>Quiz</span>
                <span class="sidebar-link__count">8 questions</span>
              </a>
            </div>
          </div>

          <!-- Teams assignment card -->
          {data.teamsReference && (
            <div class="sidebar-card sidebar-card--teams fade-in-up">
              <h3>Teams Assignment</h3>
              <p class="teams-text">{data.teamsReference}</p>
            </div>
          )}

          <!-- Learning objectives checklist -->
          <div class="sidebar-card fade-in-up">
            <h3>Learning Objectives</h3>
            <ul class="objectives-list">
              {data.learningObjectives.map((obj) => (
                <li class="objective-item">
                  <span class="objective-checkbox" aria-hidden="true"></span>
                  <span>{obj}</span>
                </li>
              ))}
            </ul>
          </div>

        </aside>

      </div>

    ) : (

      <!-- ================================================================
           "Coming soon" state for weeks without content
           ================================================================ -->
      <div class="coming-soon fade-in-up">
        <div class="coming-soon__icon" aria-hidden="true">
          <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
            <circle cx="32" cy="32" r="28" stroke="var(--border-default)" stroke-width="1.5" stroke-dasharray="6 4"/>
            <path d="M32 20v16l10 6" stroke="var(--text-muted)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <h2>Content Coming Soon</h2>
        <p>Week {weekNum} content is being prepared. Check back later.</p>
        <a href={base} class="coming-soon__link">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
            <path d="M13 8H3M7 4L3 8l4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Back to Dashboard
        </a>
      </div>

    )}

  </div>

</BaseLayout>


<style>
  /* ==========================================================================
     Week Page Styles
     ========================================================================== */

  .week-page {
    max-width: 1120px;
    margin: 0 auto;
    padding: var(--space-6) var(--space-5) var(--space-8);
  }

  /* --------------------------------------------------------------------------
     Fade-in-up animation (same as landing page)
     -------------------------------------------------------------------------- */
  .fade-in-up {
    opacity: 0;
    transform: translateY(24px);
    transition:
      opacity 0.6s cubic-bezier(0.23, 1, 0.32, 1),
      transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
  }

  .fade-in-up.is-visible {
    opacity: 1;
    transform: translateY(0);
  }


  /* ==========================================================================
     Week Header
     ========================================================================== */
  .week-header {
    margin-bottom: var(--space-7);
    padding-bottom: var(--space-6);
    border-bottom: 1px solid var(--border-subtle);
  }

  .week-header__meta {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    margin-bottom: var(--space-4);
  }

  .back-link {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    color: var(--text-secondary);
    text-decoration: none;
    transition: color var(--transition-fast);
  }

  .back-link:hover {
    color: var(--accent);
  }

  .term-badge {
    font-size: var(--text-xs);
    font-weight: var(--weight-semibold);
    font-family: var(--font-display);
    color: var(--text-muted);
    background: var(--surface-2);
    padding: var(--space-1) var(--space-3);
    border-radius: var(--radius-full);
  }

  .week-header__title-row {
    margin-bottom: var(--space-3);
  }

  .week-number {
    display: block;
    font-family: var(--font-display);
    font-size: var(--text-sm);
    font-weight: var(--weight-semibold);
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 0.06em;
    margin-bottom: var(--space-2);
  }

  .week-title {
    font-size: clamp(var(--text-2xl), 4vw, var(--text-4xl));
    font-weight: var(--weight-bold);
    line-height: var(--leading-tight);
  }

  .week-header__badges {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--space-3);
  }

  .badge {
    display: inline-flex;
    align-items: center;
    padding: var(--space-1) var(--space-3);
    font-size: var(--text-xs);
    font-weight: var(--weight-semibold);
    font-family: var(--font-display);
    border-radius: var(--radius-full);
    line-height: 1;
    white-space: nowrap;
  }

  .badge--standard {
    background: rgba(0, 255, 136, 0.1);
    color: var(--badge-colour, var(--accent));
  }

  .badge--desc {
    background: transparent;
    color: var(--text-muted);
    padding: 0;
    font-weight: var(--weight-normal);
    font-family: var(--font-body);
    font-size: var(--text-sm);
  }


  /* ==========================================================================
     Two-Column Layout (main + sidebar)
     ========================================================================== */
  .week-layout {
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: var(--space-6);
    align-items: start;
  }

  @media (max-width: 860px) {
    .week-layout {
      grid-template-columns: 1fr;
    }
  }


  /* ==========================================================================
     Main Content Area
     ========================================================================== */
  .week-main {
    display: flex;
    flex-direction: column;
    gap: var(--space-5);
  }

  /* Shared content card style */
  .content-card {
    background: var(--surface-1);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-lg);
    padding: var(--space-6);
  }

  .content-card h2 {
    font-size: var(--text-xl);
    margin-bottom: var(--space-4);
    color: var(--text-primary);
  }

  /* Placeholder content message */
  .placeholder-content {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
  }

  .placeholder-content p {
    font-size: var(--text-base);
    color: var(--text-secondary);
  }

  .placeholder-hint {
    font-size: var(--text-sm) !important;
    color: var(--text-muted) !important;
    font-style: italic;
  }

  /* Topics list */
  .topic-list {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
  }

  .topic-item {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    font-size: var(--text-base);
    color: var(--text-secondary);
  }

  .topic-bullet {
    flex-shrink: 0;
    width: 8px;
    height: 8px;
    border-radius: var(--radius-full);
    background: var(--accent);
    opacity: 0.6;
  }

  /* Key vocabulary chips */
  .vocab-grid {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    margin-bottom: var(--space-4);
  }

  .vocab-chip {
    padding: var(--space-2) var(--space-4);
    background: var(--surface-2);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-full);
    font-size: var(--text-sm);
    font-family: var(--font-body);
    color: var(--text-secondary);
    transition:
      background var(--transition-fast),
      border-color var(--transition-fast),
      color var(--transition-fast);
  }

  .vocab-chip:hover {
    background: var(--accent-muted);
    border-color: var(--accent);
    color: var(--accent);
  }


  /* ==========================================================================
     Sidebar
     ========================================================================== */
  .week-sidebar {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
  }

  .sidebar-card {
    background: var(--surface-1);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-lg);
    padding: var(--space-5);
  }

  .sidebar-card h3 {
    font-size: var(--text-base);
    font-weight: var(--weight-semibold);
    margin-bottom: var(--space-4);
    color: var(--text-primary);
  }

  /* Teams card accent */
  .sidebar-card--teams {
    border-left: 3px solid var(--purple-rich);
  }

  .teams-text {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    line-height: var(--leading-relaxed);
  }

  /* Practice links */
  .sidebar-links {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .sidebar-link {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-3) var(--space-4);
    background: var(--surface-2);
    border-radius: var(--radius-md);
    text-decoration: none;
    font-size: var(--text-sm);
    font-weight: var(--weight-medium);
    color: var(--text-primary);
    transition:
      background var(--transition-fast),
      transform var(--transition-fast);
  }

  .sidebar-link:hover {
    background: var(--surface-3);
    transform: translateX(4px);
  }

  .sidebar-link__icon {
    flex-shrink: 0;
    display: flex;
    align-items: center;
  }

  .sidebar-link__count {
    margin-left: auto;
    font-size: var(--text-xs);
    color: var(--text-muted);
    font-family: var(--font-mono);
  }

  /* Learning objectives checklist */
  .objectives-list {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
  }

  .objective-item {
    display: flex;
    align-items: flex-start;
    gap: var(--space-3);
    font-size: var(--text-sm);
    color: var(--text-secondary);
    line-height: var(--leading-relaxed);
  }

  .objective-checkbox {
    flex-shrink: 0;
    width: 18px;
    height: 18px;
    margin-top: 2px;
    border: 1.5px solid var(--border-default);
    border-radius: var(--radius-sm);
    background: var(--surface-2);
    transition:
      border-color var(--transition-fast),
      background var(--transition-fast);
  }

  .objective-item:hover .objective-checkbox {
    border-color: var(--accent);
  }


  /* ==========================================================================
     "Coming Soon" Empty State
     ========================================================================== */
  .coming-soon {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: var(--space-8) var(--space-5);
    min-height: 40vh;
    gap: var(--space-4);
  }

  .coming-soon__icon {
    margin-bottom: var(--space-2);
    opacity: 0.5;
  }

  .coming-soon h2 {
    font-size: var(--text-2xl);
    color: var(--text-primary);
  }

  .coming-soon p {
    font-size: var(--text-base);
    color: var(--text-muted);
    max-width: 400px;
  }

  .coming-soon__link {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    color: var(--accent);
    text-decoration: none;
    margin-top: var(--space-4);
    transition: gap var(--transition-fast);
  }

  .coming-soon__link:hover {
    gap: var(--space-3);
  }

  /* Stagger sidebar card animations */
  .week-sidebar .sidebar-card:nth-child(1) { transition-delay: 0.1s; }
  .week-sidebar .sidebar-card:nth-child(2) { transition-delay: 0.15s; }
  .week-sidebar .sidebar-card:nth-child(3) { transition-delay: 0.2s; }

  /* Stagger main content card animations */
  .week-main .content-card:nth-child(1) { transition-delay: 0.05s; }
  .week-main .content-card:nth-child(2) { transition-delay: 0.1s; }
  .week-main .content-card:nth-child(3) { transition-delay: 0.15s; }
</style>


<!-- ==========================================================================
     IntersectionObserver — triggers .fade-in-up animations on viewport entry
     ========================================================================== -->
<script>
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          observer.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.08, rootMargin: '0px 0px -40px 0px' }
  );

  document.querySelectorAll('.fade-in-up').forEach((el) => observer.observe(el));
</script>
