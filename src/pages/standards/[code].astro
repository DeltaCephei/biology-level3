---
/* ==========================================================================
   Individual Standard Page — shows all weeks related to a given standard.
   Generated statically for each of the five NCEA standards.
   ========================================================================== */

import BaseLayout from '../../layouts/BaseLayout.astro';
import { standards, getStandard } from '../../data/standards';

export function getStaticPaths() {
  return standards.map((s) => ({ params: { code: s.code } }));
}

const base = import.meta.env.BASE_URL.replace(/\/$/, '');
const { code } = Astro.params;
const data = getStandard(code!)!;
---

<BaseLayout title={`AS ${code}: ${data.title} — Dr Eliot's Level 3 Biology`}>

  <div class="standard-page">

    <!-- Header -->
    <header class="standard-header fade-in-up" style={`--std-colour: ${data.colour};`}>
      <div class="standard-header__meta">
        <a href={`${base}/standards`} class="back-link">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
            <path d="M13 8H3M7 4L3 8l4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          All Standards
        </a>
      </div>

      <div class="standard-header__title-row">
        <span class="standard-code">AS {code}</span>
        <h1 class="standard-title">{data.title}</h1>
      </div>

      <p class="standard-desc">{data.fullTitle}</p>

      <div class="standard-header__badges">
        <span class={`badge badge--${data.type.toLowerCase()}`}>{data.type}</span>
        <span class="badge badge--credits">{data.credits} credits</span>
      </div>
    </header>


    <!-- Week list -->
    <section class="weeks-section" aria-label="Related weeks">
      <h2 class="weeks-heading fade-in-up">
        {data.weeks.length > 0 ? 'Weeks covering this standard' : 'Content coming soon'}
      </h2>

      {data.weeks.length > 0 ? (
        <div class="weeks-list">
          {data.weeks.map((w) => (
            w.hasContent ? (
              <a href={`${base}/week/${w.num}`} class="week-row fade-in-up" style={`--std-colour: ${data.colour};`}>
                <span class="week-row__num">Week {w.num}</span>
                <span class="week-row__title">{w.title}</span>
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true" class="week-row__arrow">
                  <path d="M6 4l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </a>
            ) : (
              <div class="week-row week-row--disabled fade-in-up">
                <span class="week-row__num">Week {w.num}</span>
                <span class="week-row__title">{w.title}</span>
                <span class="week-row__coming">Coming soon</span>
              </div>
            )
          ))}
        </div>
      ) : (
        <p class="coming-text fade-in-up">
          Content for this standard is being developed. Check back soon.
        </p>
      )}
    </section>

  </div>

</BaseLayout>


<style>
  .standard-page {
    max-width: 800px;
    margin: 0 auto;
    padding: var(--space-6) var(--space-5) var(--space-8);
  }

  /* Fade-in-up */
  .fade-in-up {
    opacity: 0;
    transform: translateY(24px);
    transition:
      opacity 0.6s cubic-bezier(0.23, 1, 0.32, 1),
      transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
  }

  .fade-in-up.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* Header */
  .standard-header {
    margin-bottom: var(--space-7);
    padding-bottom: var(--space-6);
    border-bottom: 1px solid var(--border-subtle);
  }

  .standard-header__meta {
    margin-bottom: var(--space-4);
  }

  .back-link {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    color: var(--text-secondary);
    text-decoration: none;
    transition: color var(--transition-fast);
  }

  .back-link:hover {
    color: var(--accent);
  }

  .standard-code {
    display: block;
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    font-weight: var(--weight-semibold);
    color: var(--std-colour);
    margin-bottom: var(--space-2);
  }

  .standard-title {
    font-size: clamp(var(--text-2xl), 4vw, var(--text-4xl));
    font-weight: var(--weight-bold);
    line-height: var(--leading-tight);
    margin-bottom: var(--space-3);
  }

  .standard-desc {
    font-size: var(--text-base);
    color: var(--text-muted);
    line-height: var(--leading-relaxed);
    margin-bottom: var(--space-4);
  }

  .standard-header__badges {
    display: flex;
    gap: var(--space-2);
  }

  .badge {
    display: inline-flex;
    align-items: center;
    padding: var(--space-1) var(--space-3);
    font-size: var(--text-xs);
    font-weight: var(--weight-semibold);
    font-family: var(--font-display);
    border-radius: var(--radius-full);
    line-height: 1;
    white-space: nowrap;
    text-transform: uppercase;
    letter-spacing: 0.04em;
  }

  .badge--internal {
    background: rgba(0, 255, 136, 0.1);
    color: var(--green-vivid);
  }

  .badge--external {
    background: rgba(255, 110, 199, 0.1);
    color: var(--fluoro-pink);
  }

  .badge--credits {
    background: rgba(148, 163, 184, 0.1);
    color: var(--text-secondary);
  }

  /* Weeks section */
  .weeks-heading {
    font-size: var(--text-lg);
    margin-bottom: var(--space-4);
    color: var(--text-primary);
  }

  .weeks-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
  }

  .week-row {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    padding: var(--space-4) var(--space-5);
    background: var(--surface-1);
    border: 1px solid var(--border-subtle);
    border-left: 3px solid var(--std-colour);
    border-radius: var(--radius-md);
    text-decoration: none;
    color: inherit;
    transition:
      transform var(--transition-fast),
      box-shadow var(--transition-fast),
      background var(--transition-fast);
  }

  a.week-row:hover {
    transform: translateX(4px);
    box-shadow: var(--shadow-md);
    background: var(--surface-2);
  }

  .week-row--disabled {
    opacity: 0.5;
    cursor: default;
  }

  .week-row__num {
    font-family: var(--font-display);
    font-size: var(--text-sm);
    font-weight: var(--weight-semibold);
    color: var(--std-colour);
    white-space: nowrap;
    min-width: 60px;
  }

  .week-row__title {
    flex: 1;
    font-size: var(--text-base);
    color: var(--text-primary);
  }

  .week-row__arrow {
    flex-shrink: 0;
    color: var(--text-muted);
    transition: transform var(--transition-fast);
  }

  a.week-row:hover .week-row__arrow {
    transform: translateX(2px);
    color: var(--accent);
  }

  .week-row__coming {
    font-size: var(--text-xs);
    color: var(--text-muted);
    font-style: italic;
  }

  .coming-text {
    font-size: var(--text-base);
    color: var(--text-muted);
    padding: var(--space-6) 0;
  }

  /* Stagger */
  .weeks-list .week-row:nth-child(1) { transition-delay: 0.05s; }
  .weeks-list .week-row:nth-child(2) { transition-delay: 0.10s; }
  .weeks-list .week-row:nth-child(3) { transition-delay: 0.15s; }
  .weeks-list .week-row:nth-child(4) { transition-delay: 0.20s; }
</style>


<script>
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          observer.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.08, rootMargin: '0px 0px -40px 0px' }
  );
  document.querySelectorAll('.fade-in-up').forEach((el) => observer.observe(el));
</script>
